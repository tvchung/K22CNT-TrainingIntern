<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xử lý giỏ hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div id="cart" class="w-100 border m-3">
        <h1>Thông tin giỏ hàng</h1>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Thành tiền</th>
                    <th>Xóa</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Iphone 16 Pro Max </td>
                    <td class="w-25">
                        <input type="number" name="soluong" value="1" class="w-50">
                    </td>
                    <td>
                        <p data-price="1255000">1,255,000 đ</p>
                    </td>
                    <td>
                        <p class="thanh-tien" data-money="1255000">1,255,000 đ</p>
                    </td>
                    <td>
                        <button>Xóa</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Iphone 17 Pro Max </td>
                    <td class="w-25">
                        <input type="number" name="soluong" value="1" class="w-50">
                    </td>
                    <td>
                        <p  data-price="2255000">2,255,000 đ</p>
                    </td>
                    <td>
                        <p class="thanh-tien" data-money="2255000">2,255,000 đ</p>
                    </td>
                    <td>
                        <button>Xóa</button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4">Tổng thành tiền</td>
                    <td>
                        <p class="tongTien" >3,510,000 đ</p>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            console.log('running....');

            $('input[name="soluong"]').change(function(){
               let soLuong = $(this).val(); // lấy được số lượng hiện tại
               // Lấy đơn giá tương ứng
               let price = $(this).parent().siblings().children('p').attr('data-price');

               console.log("sl:",soLuong, "dg:",price);
               // Tính thành tiền
               let thanhtien = soLuong*price;
               // Gán vào cột thành tiền

                $(this).parent().siblings().children('.thanh-tien')
                    .attr('data-money',thanhtien)
                    .text(number_format(thanhtien, 0, '.', ',') + ' ₫')
                // Tính tổng thành tiền
                fn_ThanhTien();
            })
            
            // hàm tính tổng thành tiền
            const fn_ThanhTien = ()=>{
                let tongTien = 0;
                $('.thanh-tien').each(function(){
                    let tien = $(this).attr('data-money');
                    tongTien += parseFloat(tien);
                })

                $('.tongTien').text(number_format(tongTien, 0, '.', ',') + ' ₫');
            }
        })




        function number_format(number, decimals = 0, dec_point = '.', thousands_sep = ',') {
            number = (number + '').replace(/[^0-9+\-Ee.]/g, '');
            let n = !isFinite(+number) ? 0 : +number;
            let prec = !isFinite(+decimals) ? 0 : Math.abs(decimals);
            let sep = thousands_sep;
            let dec = dec_point;
            let s = '';

            let toFixedFix = function (n, prec) {
                let k = Math.pow(10, prec);
                return '' + Math.round(n * k) / k;
            };

            // Fix for IE parseFloat(0.55).toFixed(0) = 0;
            s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
            if (s[0].length > 3) {
                s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
            }
            if ((s[1] || '').length < prec) {
                s[1] = s[1] || '';
                s[1] += new Array(prec - s[1].length + 1).join('0');
            }
            return s.join(dec);
        }

    </script>
</body>
</html>